---
title: "Region 5 State of the Child: Draft Data Findings and Visuals"
author: "Catalyst California"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: hide
    number_sections: no
    theme: sandstone
    toc: yes
    toc_depth: 3
    toc_float: yes
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(comment=FALSE, message=FALSE, warning=FALSE)
# install.packages("devtools")
# devtools::install_github("r-lib/usethis")
# library(usethis)


#install packages if not already installed
# list.of.packages <- c("plyr", "openxlsx","tidyr","dplyr","stringr","RPostgreSQL","data.table", "janitor", "ggplot", "kableExtra", "extrafont", "tigris", "ggtext", "flextable", "highcharter", "tidycensus", "survey", "sysfonts", "showtext", "kableExtra", "janitor") 
# new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
# if(length(new.packages)) install.packages(new.packages)


```

The following site holds the draft findings and draft visuals from various data sources to better understand the well-being and health of children in Best Start Region 5, the Antelope Valley. The findings and visuals are being developed by Catalyst California for the Region 5 State of the Child report in collaboration with The Children's Bureau.

```{r}
# Prep and Set Up 
#### Loading Libraries ####
library(dplyr)
library(ggplot2)
library(RPostgreSQL)
library(devtools)
library(janitor)
library(tidyr)
library(data.table)
library(sysfonts)
library(showtext)
library(sf)

#### First 5 LA Style Guide ####
## COLORS## Taken from W:\Project\RDA Team\Region 5 State of the Child\Documentation\F5LA_BrandGuidelines_COLORS.pdf
#primary
lightblue <- "#009CDB"
darkblue <- "#332985"
tealblue <- "#22BCB8"
black <- "#000000"
textgrey <- "#919191"
#secondary 
green <- "#54B847"
orange <- "#F58326"
hotpink <- "#EC098C"
red <- "#EF4034"

## FONTS ##
# Step 1: Download fonts (Gotham Bold and Gotham Book) 
# Step 2: Load the downloaded fonts into the R script:
# General: See tutorial here, under "THE SHOWTEXT PACKAGE" section: https://r-coder.com/custom-fonts-r/#The_showtext_package 
# Step 3: Run the code below in each R script

font_add(family = "GothamBold", regular = "C:/Windows/Fonts/Gotham-Bold 700.otf")
font_add(family = "GothamBook", regular = "C:/Windows/Fonts/Gotham-Book 325.otf")

showtext_auto()

# define fonts in chart
font_title <- "GothamBold"
font_subtitle <- "GothamBook"
font_caption <- "GothamBook"
font_bar_label <- "GothamBold"
font_axis_label <- "GothamBook"
font_table_text<-"GothamBook"

#### Loading Database from PgAdmin/Postgres #### 
source("password_protection.R")

drv <- dbDriver("PostgreSQL")

con <- dbConnect(drv, dbname = "region5stateofthechild",
                   host = "aws-postgres-db.c5udgz7ro8hq.us-west-2.rds.amazonaws.com", port = 5432,
                   user = "postgres", password = pw)

#### Static Visual Functions ####

#Reference: W:\Project\RDA Team\LAFed\R\LAFed\visual_functions_static.R

```

# Demographics 

## Population of Children and Families

The Antelope Valley is a 2,200 square mile area in northern Los Angeles County [1](https://en.wikipedia.org/wiki/Antelope_Valley). According to the US Census, it's two largest cities, Lancaster and Palmdale, have populations of 170,150 and 165,761, respectively.[1](https://www.census.gov/quickfacts/fact/table/palmdalecitycalifornia,lancastercitycalifornia/PST045221). For comparison, both cities are more populous than Pasadena and Pomona, two well-known mid-size cities on the other side of the valley.

**The Antelope Valley Best Start Region 5 is home to a population of 368,522 people [1](https://public.tableau.com/app/profile/luz3725/viz/2020CensusData-AVBESTSTARTREGION5/GRAPI)**. According to Catalyst California calculations of 2020 American Community Survey estimates, **the Lancaster and Palmdale Best Start geographies hold roughly 25,000 children**, with 12,821 and 13,068 children ages 0 to 5, respectively. These 25,000+ children represent more than 7% of the Lancaster and Palmdale Best Start geography populations.


## Racial Ethnic Breakdown 

According to the latest American Community Survey data calculated by Lucy Wilkerson, **Region 5 is majority Latinx and the regional share of the Black population is twice the LA County share and nearly three times the State share**. On the other hand, the region is home to relatively fewer Asian residents than the County and State as a whole. 

**Race-ethnicity of Region 5 and Key Geographies**
```{r}
source("W:/Project/RDA Team/Region 5 State of the Child/R/race.R")

library(kableExtra)
kbl(race_data) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```
Source: [American Community Survey 2016-2020 5-year estimates calculated for Antelope Valley neighborhoods by Lucy Wilkerson](https://public.tableau.com/app/profile/luz3725/viz/2020CensusData-AVBESTSTARTREGION5/GRAPI)

## Black Infant Mortality 

According to the California Department of Public Health, Los Angeles County Black infant mortality rates are more than twice the rate of infant mortality overall (9.3 vs. 4.2 infant deaths per 1,000 live births). Not available by race, but First 5 LA reports Children's Data Network infant mortality rates for the total populations of the Lancaster and Palmdale Best Start geographies at 6.0 and 5.7 per 1,000, respectively.[1](https://www.first5la.org/wp-content/uploads/2020/09/First-5-LA-2020-Indicators-Report.pdf)

**The County's Black infant mortality rate is twice the infant mortality rate overall: 9.3 Black LA County infant deaths per 1,000 live births compared to total rate of 4.2 per 1,000**[1](https://data.chhs.ca.gov/dataset/infant-mortality-deaths-per-1000-live-births-lghc-indicator-01/resource/ae78da8f-1661-45f6-b2d0-1014857d16e3)

Recent data are a challenge as this data, from the California Health and Human Services Open Data Portal is from 2015-2017. The [African American Infant and Maternal Mortality (AAIMM) Initiative](https://www.blackinfantsandfamilies.org/) is a coalition working to address the unacceptably high rates of Black infant and maternal deaths in the County. [A Pathway to Equity](http://publichealth.lacounty.gov/centerforhealthequity/PDF/AAIM-ActionPlan.pdf) is a framework for understanding the causes of infant mortality and the steps needed to address it.

## Children of Incarcerated

According to Catalyst California calculations of Vera Institute for Justice, County of Los Angeles Probation, and the Bureau of Justice Statistics, there are an estimated **90,000 children in Los Angeles County with a parent in State Prison, LA County Jail, or under LA County probation and 17,000 of these children are ages 0 to 5**. This means that roughly 1 in 20 LA County children have an incarcerated parent or parent under probation. Roughly 20,000 of these children are Black with 4,000 of them between the age 0 to 5.

Because the criminal justice system over criminalizes Black and Brown parents, children of incarcerated parents or parents under probation are more likely to be Latino or Black than their share of the total population. **Black children make up 22% of Los Angeles County children with an incarcerated parent or parent under probation but are only 7.5% of the total population**. By contrast, White children make up 11.6% of county children with an incarcerated parent or parent under probation but are 20.4% of the total population.

```{r}

Race <- c("Percent children of incarcerated or probation parent", "Percent of County children", "Difference")
Black <- c("22.0%",	"7.5%",	"14.5%")
Latino <- c("63.0%",	"55.7%",	"7.3%")
NHPI <- c("0.1%",	"0.2%",	"-0.1%")
AIAN <- c("0.1%",	"0.2%",	"-0.1%")
Other <- c("2.8%",	"3.3%",	"-0.5%")
White <- c("11.6%",	"20.4%",	"-8.8%")
Asian <- c("0.4%",	"12.7%",	"-12.3%")
Total <- c("100%",	"100%",	"0%")

incarc_table <- rbind(Race, Black, Latino, NHPI, AIAN, Other, White, Asian, Total)

library(kableExtra)
kbl(incarc_table) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```

This matters because separation or probation impacts the ability of parents to live with, supervise, and be attentive to their children. They are not as able to help with homework, know who their kids’ friends are, have a sense of how school is going, and what their children are eating, for example. Each of these things impact a child’s ability to succeed in school, be healthy, and otherwise thrive.

## Foster Youth Population 

Overall in the Antelope Valley (AV) during the 2021-2022 school year, 2.3% of students are in the Foster Care System. Black (5.2%) and American Indian / Alaskan Native (5.3%) students are over 10 times more likely to be in the foster care system than Asian (0.5%) students, the group least likely to be in the foster care system in the AV. Native Hawaiian / Pacific Islander (4.2%) students also have a high rate of students in foster care compared to the AV average, almost 2 times more in fact. At the district level, the Eastside Union Elementary School District has almost double the percentage of students in foster care compared to the AV average and over 7 times more compared to the School District with the lowest percentage.

 **Foster Youth Rates by District 2021-22 School Year**
```{r}
source("W:/Project/RDA Team/Region 5 State of the Child/R/foster.R")
library(kableExtra)

 
kbl(av_table) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))


```

Source: [California Department of Education, 2016-2022](https://dq.cde.ca.gov/dataquest/)

```{r}
# AV Bar Chart
s <- AV 
tot = subset(s, select=c(total_rate)) %>% round(1)  # pull out total_rate
s = subset(s, select=-c(total_rate)) # pull out raced rates
oldnames = c("nh_black_rate","nh_aian_rate", "nh_asian_rate", "nh_filipino_rate", "latino_rate", "nh_pacisl_rate", "nh_white_rate", "nh_twoormor_rate")
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
s = s %>% rename_at(vars(oldnames), ~ engvar)

# create english / spanish labels
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
esvar = c("Negro", "Indígena Americano", "Asiático", "Filipino", "Latino", "Isleño del Pacifico", "Blanco", "Dos o mas") 
#esvar_long = c("NEGRO O AFROAMERICANO", "INDÍGENA AMERICANO O NATIVO DE ALASKA", "ASIÁTICO", "FILIPINO", "LATINO", "ISLEÑO DEL PACIFICO", "BLANCO", "DOS O MAS")
labels <- data.frame(engvar, esvar)
# labels


# convert df to long format
s_long <- reshape2::melt(s, id.vars=c("geoname"))
# Round 'value' field to 1 decimal, rename 'variable' field, add Spanish labels
s_long <- s_long %>% mutate(value = round(value, 1)) %>% dplyr::rename(engvar = variable)  %>% 
  left_join(labels, by = "engvar")
s_long <- s_long %>% filter(value > 0)


df <- data.frame(s_long, tot)       # add total_rate to long table
df <- na.omit(df)             # drop NA's
# df

engtot_stat <- paste("Overall Rate =", min(df$total_rate))   # total_rate line annotation
estot_stat <- paste("Promedio Total =", min(df$total_rate))   # total_rate line annotation


# Set region name for file name
region <- "Antelope Valley"


# write the name of your indicator here:
var <- "foster"


# Define chart height as max y value varies by indicator. Set vertical position for total line label - may need to be customized for each chart.
max_y = 1.15 * max(df$value) 
annotate_y = 1.12 * df$total_rate

# specify language: comment out based on language of chart created below
lang <- "eng"

# # ggplot method that should export as .svg ##
av_plot <- 
  #English
  ggplot(df, aes(x= reorder(engvar, -value), y=value)) +     # set up manual fill using 'test', add "-" before value to order bars when MAX is best
  annotate("text", x=6.25, y = annotate_y, label = str_wrap(engtot_stat, width = 20), hjust=-0.33, vjust = 0.35, family= font_table_text, color = red) +  
  labs(title = "**<span style='font-size:20pt;'>Population of Students in Foster Care (%)</span>**", subtitle = region, caption = "*American Indian and Alaska Native (AIAN), Native Hawaiian and Pacific Islander (NHPI)") +
  # rest of chart    
  geom_bar(stat="identity", position = position_dodge(0.7), show.legend = FALSE) +
  geom_col(fill = lightblue, color = darkblue) +         # all bars in "#355C7D"
  geom_hline(aes(yintercept = round(total_rate, 1)), color = red, size = .5) + 
  geom_text(aes(label = round(value, digits = 1)), family = font_bar_label, hjust = -.5) +       # format data labels, adjust hjust to avoid overlap w/ total line
  # scale_y_continuous(limits = c(0, max_y), breaks = seq(0, max_y, by = 20)) +
  scale_x_discrete(labels = function(engvar) str_wrap(engvar, width = 20)) +            # wrap long labels
  xlab("") +
  ylab("") +
  coord_flip()
# av_plot

av_plot <- av_plot + theme(
  panel.background = element_rect(fill = "transparent"), # bg of the panel
  plot.background = element_rect(fill = 'transparent', color=NA), 
  panel.grid.major.y = element_line(colour = textgrey),    # add major y-axis gridlines
  panel.grid.minor = element_blank(), # bg of the plot
  axis.title.x = element_blank(),
  axis.title.y = element_blank(),
  axis.text.x = element_text(size = 12, family= font_axis_label),
  axis.text.y = element_text(size = 12, family= font_axis_label),
  axis.ticks = element_blank(),
  plot.title = element_markdown(family = font_title, face = "bold", size = 15, hjust = 0),
  plot.title.position = "plot",
  plot.subtitle = element_text(family = font_title, hjust = 0), 
  plot.margin = margin(t = 10,
                       b = 10,
                       r = 10,
                       l = 10)
)


av_plot <- av_plot + ylim(0, max_y)     # add buffer between title and chart/data labels
av_plot


```

Source: [California Department of Education, 2016-2022](https://dq.cde.ca.gov/dataquest/)


## Student Migrant Population

Overall, 0.3% of students are in the California's Migrant Education Program in the Antelope Valley. Palmdale Elementary School District has a 2.7 times greater percentage of migratory students than the AV average. That is because of American Indian Alaskan Native students in the Palmdale elementary school district has 3.2 times more migratory student than even the next largest group of migratory students, Latinx students. At the region level as well, American Indian Alaskan Native student has the greatest percentage of migratory students.

 **Student Migrant Population Counts by District 2021-22 School Year**
```{r}
source("W:/Project/RDA Team/Region 5 State of the Child/R/migrant.R")
library(kableExtra)

 
kbl(av_table) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))


```

Source: [California Department of Education, 2016-2022](https://dq.cde.ca.gov/dataquest/)

```{r}
# AV Bar Chart
s <- AV 
tot = subset(s, select=c(total_rate)) %>% round(1)  # pull out total_rate
s = subset(s, select=-c(total_rate)) # pull out raced rates
oldnames = c("nh_black_rate","nh_aian_rate", "nh_asian_rate", "nh_filipino_rate", "latino_rate", "nh_pacisl_rate", "nh_white_rate", "nh_twoormor_rate")
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
s = s %>% rename_at(vars(oldnames), ~ engvar)

# create english / spanish labels
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
esvar = c("Negro", "Indígena Americano", "Asiático", "Filipino", "Latino", "Isleño del Pacifico", "Blanco", "Dos o mas") 
#esvar_long = c("NEGRO O AFROAMERICANO", "INDÍGENA AMERICANO O NATIVO DE ALASKA", "ASIÁTICO", "FILIPINO", "LATINO", "ISLEÑO DEL PACIFICO", "BLANCO", "DOS O MAS")
labels <- data.frame(engvar, esvar)
# labels


# convert df to long format
s_long <- reshape2::melt(s, id.vars=c("geoname"))
# Round 'value' field to 1 decimal, rename 'variable' field, add Spanish labels
s_long <- s_long %>% mutate(value = round(value, 1)) %>% dplyr::rename(engvar = variable)  %>% 
  left_join(labels, by = "engvar")
s_long <- s_long %>% filter(value > 0)


df <- data.frame(s_long, tot)       # add total_rate to long table
df <- na.omit(df)             # drop NA's
# df

engtot_stat <- paste("Overall Rate =", min(df$total_rate))   # total_rate line annotation
estot_stat <- paste("Promedio Total =", min(df$total_rate))   # total_rate line annotation


# Set region name for file name
region <- "Antelope Valley"


# write the name of your indicator here:
var <- "migrant"


# Define chart height as max y value varies by indicator. Set vertical position for total line label - may need to be customized for each chart.
max_y = max(df$value) 
annotate_y = 1.55 * df$total_rate

# specify language: comment out based on language of chart created below
lang <- "eng"


# # ggplot method that should export as .svg ##
av_plot <- 
  #English
  ggplot(df, aes(x= reorder(engvar, -value), y=value)) +     # set up manual fill using 'test', add "-" before value to order bars when MAX is best
  annotate("text", x=2.25, y = annotate_y, label = str_wrap(engtot_stat, width = 20), hjust=-0.33, vjust = 0.35, family= font_table_text, color = red) +  
  labs(title = "**<span style='font-size:20pt;'>Student Migrant Population (%)</span>**", subtitle = region, caption = "*American Indian and Alaska Native (AIAN), Native Hawaiian and Pacific Islander (NHPI)") +
  # rest of chart    
  geom_bar(stat="identity", position = position_dodge(0.7), show.legend = FALSE) +
  geom_col(fill = lightblue, color = darkblue) +         # all bars in "#355C7D"
  geom_hline(aes(yintercept = round(total_rate, 1)), color = red, size = .5) + 
  geom_text(aes(label = round(value, digits = 1)), family = font_bar_label, hjust = -.5) +       # format data labels, adjust hjust to avoid overlap w/ total line
  # scale_y_continuous(limits = c(0, max_y), breaks = seq(0, max_y, by = 20)) +
  scale_x_discrete(labels = function(engvar) str_wrap(engvar, width = 20)) +            # wrap long labels
  xlab("") +
  ylab("") +
  coord_flip()
# av_plot

av_plot <- av_plot + theme(
  panel.background = element_rect(fill = "transparent"), # bg of the panel
  plot.background = element_rect(fill = 'transparent', color=NA), 
  panel.grid.major.y = element_line(colour = textgrey),    # add major y-axis gridlines
  panel.grid.minor = element_blank(), # bg of the plot
  axis.title.x = element_blank(),
  axis.title.y = element_blank(),
  axis.text.x = element_text(size = 12, family= font_axis_label),
  axis.text.y = element_text(size = 12, family= font_axis_label),
  axis.ticks = element_blank(),
  plot.title = element_markdown(family = font_title, face = "bold", size = 15, hjust = 0),
  plot.title.position = "plot",
  plot.subtitle = element_text(family = font_title, hjust = 0), 
  plot.margin = margin(t = 10,
                     b = 10,
                     r = 10,
                     l = 10)
)


av_plot <- av_plot + ylim(0, max_y)     # add buffer between title and chart/data labels
av_plot

```

Source: [California Department of Education, 2016-2022](https://dq.cde.ca.gov/dataquest/)

### Non-binary
The CDE started tracking students who identify as non-binary gender in the 2020-21 School Year. At that time, 23 students in the Antelope Valley identified as non-binary. Now in the 2021-22 School Year, that number has increased to 51 students or 0.1% of the total AV student population. By percent, AIAN students had the highest rate of students who identified (0.6%) while in raw count Latinx students had the most students (26 students).

The Acton-Agua Dulce School District has the largest percentage of students who identify as non-binary during the 2020-21 school year. 44 out fo the 51 students who identify as non-binary were in the Acton-Agua School District. 

 **Non-Binary Counts by School District 2021-22 School Year**
```{r}

source("W:/Project/RDA Team/Region 5 State of the Child/R/non-binary.R")
library(kableExtra)

 
kbl(av_table) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```

Source: [California Department of Education, 2016-2022](https://dq.cde.ca.gov/dataquest/)

```{r}
# AV Bar Chart
s <- AV 
tot = subset(s, select=c(total_rate)) %>% round(1)  # pull out total_rate
s = subset(s, select=-c(total_rate)) # pull out raced rates
oldnames = c("nh_black_rate","nh_aian_rate", "nh_asian_rate", "nh_filipino_rate", "latino_rate", "nh_pacisl_rate", "nh_white_rate", "nh_twoormor_rate")
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
s = s %>% rename_at(vars(oldnames), ~ engvar)

# create english / spanish labels
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
esvar = c("Negro", "Indígena Americano", "Asiático", "Filipino", "Latino", "Isleño del Pacifico", "Blanco", "Dos o mas") 
#esvar_long = c("NEGRO O AFROAMERICANO", "INDÍGENA AMERICANO O NATIVO DE ALASKA", "ASIÁTICO", "FILIPINO", "LATINO", "ISLEÑO DEL PACIFICO", "BLANCO", "DOS O MAS")
labels <- data.frame(engvar, esvar)
# labels


# convert df to long format
s_long <- reshape2::melt(s, id.vars=c("geoname"))
# Round 'value' field to 1 decimal, rename 'variable' field, add Spanish labels
s_long <- s_long %>% mutate(value = round(value, 1)) %>% dplyr::rename(engvar = variable)  %>% 
  left_join(labels, by = "engvar")
s_long <- s_long %>% filter(value > 0)


df <- data.frame(s_long, tot)       # add total_rate to long table
df <- na.omit(df)             # drop NA's
# df

engtot_stat <- paste("Overall Rate =", min(df$total_rate))   # total_rate line annotation
estot_stat <- paste("Promedio Total =", min(df$total_rate))   # total_rate line annotation


# Set region name for file name
region <- "Antelope Valley"


# write the name of your indicator here:
var <- "non-binary"


# Define chart height as max y value varies by indicator. Set vertical position for total line label - may need to be customized for each chart.
max_y = max(df$value) 
annotate_y = 1.12 * df$total_rate

# specify language: comment out based on language of chart created below
lang <- "eng"

# # ggplot method that should export as .svg ##
av_plot <- 
  #English
  ggplot(df, aes(x= reorder(engvar, -value), y=value)) +     # set up manual fill using 'test', add "-" before value to order bars when MAX is best
  annotate("text", x=3.25, y = annotate_y, label = str_wrap(engtot_stat, width = 20), hjust=-0.33, vjust = 0.35, family= font_table_text, color = red) +  
  labs(title = "**<span style='font-size:20pt;'>Non-binary Students (%)</span>**", subtitle = region, caption = "*American Indian and Alaska Native (AIAN), Native Hawaiian and Pacific Islander (NHPI)") +
  # rest of chart    
  geom_bar(stat="identity", position = position_dodge(0.7), show.legend = FALSE) +
  geom_col(fill = lightblue, color = darkblue) +         # all bars in "#355C7D"
  geom_hline(aes(yintercept = round(total_rate, 1)), color = red, size = .5) + 
  geom_text(aes(label = round(value, digits = 1)), family = font_bar_label, hjust = -.5) +       # format data labels, adjust hjust to avoid overlap w/ total line
  # scale_y_continuous(limits = c(0, max_y), breaks = seq(0, max_y, by = 20)) +
  scale_x_discrete(labels = function(engvar) str_wrap(engvar, width = 20)) +            # wrap long labels
  xlab("") +
  ylab("") +
  coord_flip()

av_plot <- av_plot + theme(
  panel.background = element_rect(fill = "transparent"), # bg of the panel
  plot.background = element_rect(fill = 'transparent', color=NA),
  panel.grid.major.y = element_line(colour = textgrey),    # add major y-axis gridlines
  panel.grid.minor = element_blank(), # bg of the plot
  axis.title.x = element_blank(),
  axis.title.y = element_blank(),
  axis.text.x = element_text(size = 12, family= font_axis_label),
  axis.text.y = element_text(size = 12, family= font_axis_label),
  axis.ticks = element_blank(),
  plot.title = element_markdown(family = font_title, face = "bold", size = 15, hjust = 0),
  plot.title.position = "plot",
  plot.subtitle = element_text(family = font_title, hjust = 0),
  plot.margin = margin(t = 10,
                       b = 10,
                       r = 10,
                       l = 10)
)


av_plot <- av_plot + ylim(0, max_y)     # add buffer between title and chart/data labels
av_plot


```

Source: [California Department of Education, 2016-2022](https://dq.cde.ca.gov/dataquest/)

## Socioeconomically Disadvantaged

The CDE has a category called Socioeconomically disadvantaged that it defines with the following criteria: 
  * student is eligible or participating in the Free or Reduce Meal program, Migrant program, or Foster program
  * the student's parents do not have a high school diploma
  * the student was Homeless, Directly Certified, a Tribal Foster Youth, or enrolled in a Juvenile Court School

In further definition, Direct Certification, means that the student was eligible for the Free Meal program without having to apply for it separately. That is usually because the student is already registered for other social or welfare services such as CalFresh or CalWORKs.(cde.ca.gov)

In the 2021-22 school year, an extremely high percentage, 75% of students, were categorized as socioeconomically disadvantaged. In particular Black (84%), American Indian Alaskan Native (82%), and Latinx (80%) students had the highest rates in the Antelope Valley. In the the racial and ethnic groups with the lowest rates in the AV, still around half of students were considered socioeconomically disadvantaged. These high rates were specially pervasive in the Wilsona Elementary School District where 97%, almost all students where considered socioeconomically disavantaged. In that district, Black and Native Hawaiian Pacific Islander students had the highest rates (approx. 100% for both), closely followed by Latinx students (98%). 

 **Socioeconomically Disadvantaged Rates by School District 2021-22 School Year**
```{r}

source("W:/Project/RDA Team/Region 5 State of the Child/R/socioeconomically_disadvantaged.R")
library(kableExtra)
kbl(av_table) %>%
 kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```

Source: [California Department of Education, 2016-2022](https://dq.cde.ca.gov/dataquest/)

```{r}
## AV Bar Chart
s <- AV 
tot = subset(s, select=c(total_rate)) %>% round(1)  # pull out total_rate
s = subset(s, select=-c(total_rate)) # pull out raced rates
oldnames = c("nh_black_rate","nh_aian_rate", "nh_asian_rate", "nh_filipino_rate", "latino_rate", "nh_pacisl_rate", "nh_white_rate", "nh_twoormor_rate")
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
s = s %>% rename_at(vars(oldnames), ~ engvar)

# create english / spanish labels
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
esvar = c("Negro", "Indígena Americano", "Asiático", "Filipino", "Latino", "Isleño del Pacifico", "Blanco", "Dos o mas") 
#esvar_long = c("NEGRO O AFROAMERICANO", "INDÍGENA AMERICANO O NATIVO DE ALASKA", "ASIÁTICO", "FILIPINO", "LATINO", "ISLEÑO DEL PACIFICO", "BLANCO", "DOS O MAS")
labels <- data.frame(engvar, esvar)
# labels


# convert df to long format
s_long <- reshape2::melt(s, id.vars=c("geoname"))
# Round 'value' field to 1 decimal, rename 'variable' field, add Spanish labels
s_long <- s_long %>% mutate(value = round(value, 1)) %>% dplyr::rename(engvar = variable)  %>% 
  left_join(labels, by = "engvar")
s_long <- s_long %>% filter(value > 0)


df <- data.frame(s_long, tot)       # add total_rate to long table
df <- na.omit(df)             # drop NA's
# df

engtot_stat <- paste("Overall Rate =", min(df$total_rate))   # total_rate line annotation
estot_stat <- paste("Promedio Total =", min(df$total_rate))   # total_rate line annotation


# Set region name for file name
region <- "Antelope Valley"


# write the name of your indicator here:
var <- "socioeconomically_disadvantaged"


# Define chart height as max y value varies by indicator. Set vertical position for total line label - may need to be customized for each chart.
max_y = 1.15 * max(df$value) 
annotate_y = df$total_rate

# specify language: comment out based on language of chart created below
lang <- "eng"


# # ggplot method that should export as .svg ##
av_plot <- 
  #English
  ggplot(df, aes(x= reorder(engvar, -value), y=value)) +     # set up manual fill using 'test', add "-" before value to order bars when MAX is best
  annotate("text", x=6.25, y = annotate_y, label = str_wrap(engtot_stat, width = 20), hjust=-0.33, vjust = 0.35, family= font_table_text, color = red) +  
  labs(title = "**<span style='font-size:20pt;'>Socioeconomically Disadvantaged (%)</span>**", subtitle = region, caption = "*American Indian and Alaska Native (AIAN), Native Hawaiian and Pacific Islander (NHPI)") +
  # rest of chart    
  geom_bar(stat="identity", position = position_dodge(0.7), show.legend = FALSE) +
  geom_col(fill = lightblue, color = darkblue) +         # all bars in "#355C7D"
  geom_hline(aes(yintercept = round(total_rate, 1)), color = red, size = .5) + 
  geom_text(aes(label = round(value, digits = 1)), family = font_bar_label, hjust = -.5) +       # format data labels, adjust hjust to avoid overlap w/ total line
  # scale_y_continuous(limits = c(0, max_y), breaks = seq(0, max_y, by = 20)) +
  scale_x_discrete(labels = function(engvar) str_wrap(engvar, width = 20)) +            # wrap long labels
  xlab("") +
  ylab("") +
  coord_flip()
# av_plot

av_plot <- av_plot + theme(
  panel.background = element_rect(fill = "transparent"), # bg of the panel
  plot.background = element_rect(fill = 'transparent', color=NA),
  panel.grid.major.y = element_line(colour = textgrey),    # add major y-axis gridlines
  panel.grid.minor = element_blank(), # bg of the plot
  axis.title.x = element_blank(),
  axis.title.y = element_blank(),
  axis.text.x = element_text(size = 12, family= font_axis_label),
  axis.text.y = element_text(size = 12, family= font_axis_label),
  axis.ticks = element_blank(),
  plot.title = element_markdown(family = font_title, face = "bold", size = 15, hjust = 0),
  plot.title.position = "plot",
  plot.subtitle = element_text(family = font_title, hjust = 0),
  plot.margin = margin(t = 10,
                       b = 10,
                       r = 10,
                       l = 10)
)


av_plot <- av_plot + ylim(0, max_y)     # add buffer between title and chart/data labels
av_plot


```

Source: [California Department of Education, 2016-2022](https://dq.cde.ca.gov/dataquest/)

## Student Homelessness

According to the California Department Of Education 2021_22 school year data, Student Homelessness on average in the Antelope Valley, 2.2%, is slightly lower than the the state average, 2.9%, and Los Angeles County average, 2.8%. However, school district level data tells a different story.

Student Homelessness is especially high in the Westside Union Elementary School District with an average rate of 7.2%, over 3 times the average of the entire Antelope Valley, 2.1%. That means that approx. 7 out of every 100 students in the Westside Union Elementary School District is experiencing homelessness. Although there are high rates among all groups in the the Westside Union Elementary School District, the high rates of homelessness among Non-Hispanic American Indian Alaskan Native (AIAN) students (14.3%), Non-Hispanic Black students (7.6%), Latinx students (8.2%), and students who identified as Non-Hispanic Two or More Races (8.1%) especially stand out. 

The Hughes-Elizabeth Lakes Union Elementary School District and the Wilsona Elementary School District had the next highest rates, both being 2.3 times higher than the state average. For the Hughes-Elizabeth Lakes Union Elementary School District, the high rates for Latinx students were the highest (5.7%). In the case of the Wilsona Elementary School District, the high rates for Black (11.5%), Latinx (6.6%), and White students (6.2%) especially drove up the average.

The Eastside Union Elementary School District and Lancaster Elementary School District also had above average rates, being 2 and 1.2 times higher than the state average respectively. Regionally, students who identified as Non-Hispanic Two or More Races and Non-Hispanic Black and Non-Hispanic AIAN students had the highest rates. 

The bulk of the students experiencing homelessness in the Antelope Valley are in grades 1-8. Notably, student homelessness rates range between 15 to 20% of students. Second-grade students had the highest rates with 2 out of 10 experiencing homelessness. 

Given this information, interventions targeting current elementary and middle school students,  and Black, Latinx, AIAN, and Two or More Race students are pressing.

 **Student Homelessness Rates by School District 2021-22 School Year**
```{r}
# 2021-22 School Year Totals
source("W:/Project/RDA Team/Region 5 State of the Child/R/student_homelessness.R")
library(kableExtra)

 
kbl(av_table) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))


```

Source: [California Department of Education, 2016-2022](https://dq.cde.ca.gov/dataquest/)


```{r}
# AV Bar Chart
s <- AV 
tot = subset(s, select=c(total_rate)) %>% round(1)  # pull out total_rate
s = subset(s, select=-c(total_rate)) # pull out raced rates
oldnames = c("nh_black_rate","nh_aian_rate", "nh_asian_rate", "nh_filipino_rate", "latino_rate", "nh_pacisl_rate", "nh_white_rate", "nh_twoormor_rate")
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
s = s %>% rename_at(vars(oldnames), ~ engvar)

# create english / spanish labels
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
esvar = c("Negro", "Indígena Americano", "Asiático", "Filipino", "Latino", "Isleño del Pacifico", "Blanco", "Dos o mas") 
#esvar_long = c("NEGRO O AFROAMERICANO", "INDÍGENA AMERICANO O NATIVO DE ALASKA", "ASIÁTICO", "FILIPINO", "LATINO", "ISLEÑO DEL PACIFICO", "BLANCO", "DOS O MAS")
labels <- data.frame(engvar, esvar)
# labels


# convert df to long format
s_long <- reshape2::melt(s, id.vars=c("geoname"))
# Round 'value' field to 1 decimal, rename 'variable' field, add Spanish labels
s_long <- s_long %>% mutate(value = round(value, 1)) %>% dplyr::rename(engvar = variable)  %>% 
  left_join(labels, by = "engvar")
s_long <- s_long %>% filter(value > 0)


df <- data.frame(s_long, tot)       # add total_rate to long table
df <- na.omit(df)             # drop NA's
# df

engtot_stat <- paste("Overall Rate =", min(df$total_rate))   # total_rate line annotation
estot_stat <- paste("Promedio Total =", min(df$total_rate))   # total_rate line annotation


# Set region name for file name
region <- "Antelope Valley"


# write the name of your indicator here:
var <- "student_homelessness"


# Define chart height as max y value varies by indicator. Set vertical position for total line label - may need to be customized for each chart.
max_y = 1.15 * max(df$value) 
annotate_y = 1.12 * df$total_rate

# specify language: comment out based on language of chart created below
lang <- "eng"

# # ggplot method that should export as .svg ##
av_plot <- 
  #English
  ggplot(df, aes(x= reorder(engvar, -value), y=value)) +     # set up manual fill using 'test', add "-" before value to order bars when MAX is best
  annotate("text", x=6.25, y = annotate_y, label = str_wrap(engtot_stat, width = 20), hjust=-0.33, vjust = 0.35, family= font_table_text, color = red) +  
  labs(title = "**<span style='font-size:20pt;'>Student Homelessness (%)</span>**", subtitle = region, caption = "*American Indian and Alaska Native (AIAN), Native Hawaiian and Pacific Islander (NHPI)") +
  # rest of chart    
  geom_bar(stat="identity", position = position_dodge(0.7), show.legend = FALSE) +
  geom_col(fill = lightblue, color = darkblue) +         # all bars in "#355C7D"
  geom_hline(aes(yintercept = round(total_rate, 1)), color = red, size = .5) + 
  geom_text(aes(label = round(value, digits = 1)), family = font_bar_label, hjust = -.5) +       # format data labels, adjust hjust to avoid overlap w/ total line
  # scale_y_continuous(limits = c(0, max_y), breaks = seq(0, max_y, by = 20)) +
  scale_x_discrete(labels = function(engvar) str_wrap(engvar, width = 20)) +            # wrap long labels
  xlab("") +
  ylab("") +
  coord_flip()
# av_plot

av_plot <- av_plot + theme(
  panel.background = element_rect(fill = "transparent"), # bg of the panel
  plot.background = element_rect(fill = 'transparent', color=NA), 
  panel.grid.major.y = element_line(colour = textgrey),    # add major y-axis gridlines
  panel.grid.minor = element_blank(), # bg of the plot
  axis.title.x = element_blank(),
  axis.title.y = element_blank(),
  axis.text.x = element_text(size = 12, family= font_axis_label),
  axis.text.y = element_text(size = 12, family= font_axis_label),
  axis.ticks = element_blank(),
  plot.title = element_markdown(family = font_title, face = "bold", size = 15, hjust = 0),
  plot.title.position = "plot",
  plot.subtitle = element_text(family = font_title, hjust = 0), 
  plot.margin = margin(t = 10,
                       b = 10,
                       r = 10,
                       l = 10)
)


av_plot <- av_plot + ylim(0, max_y)     # add buffer between title and chart/data labels
av_plot


```

Source: [California Department of Education, 2016-2022](https://dq.cde.ca.gov/dataquest/)


## Homelessness

The 2022 Los Angeles County homeless count counted over 65,000 homeless people in Los Angeles County, 1,000 of whom lived in the cities of Lancaster and Palmdale.Thousands more homeless residents live just outside city boundaries in the Antelope Valley (SPA 1). **LAHSA counted 4,598 Antelope Valley homeless persons in 2022 including 3,570 unsheltered and 1,028 sheltered persons.** Another way to break that 4,500+ homeless population shows that figure is made up of 3,681 individuals, 910 family members, and 7 unaccompanied minors.A [Vice News Report](https://www.youtube.com/watch?v=LzbU-9L1WS4) details that law enforcement contributes to moving homeless persons outside of city boundaries and into the broader region. 

**Adult & youth sheltered and adult unsheltered in Antelope Valley geographies, 2022**
```{r}
source("W:/Project/RDA Team/Region 5 State of the Child/R/homeless.R")

library(kableExtra)
kbl(av_table) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```

Source: [Los Angeles Homeless Services Authority, 2022](https://www.lahsa.org/data)


## Children with Disabilities 

Overall in the Antelope Valley, 14.9% of students have disabilities, 2.4 percentage points higher than the state average.[2](https://lao.ca.gov/reports/2019/4110/overview-spec-ed-110619.pdf) The percentage of students with disabilities in the Antelope Valley has steadily increased by 2.6 percentage points since the 2015-16 school year. The grades with the highest percentage of students with disabilities were 6th grade (73.5%), 8th grade (71.8%), and 7th grade (73.5%). At the school district level, the Antelope Valley Union Joint High School District has the highest, 17.2% and Eastside Elementary School District has the lowest, 12.5%.  Students in the 4th and 5th grades also had a larger percentage of students with disabilities. Despite the high reported numbers of students with disabilities, the actual numbers are likely higher. Younger students with disabilities tend to be underrepresented because students are assessed for disabilities on an as-needed basis, therefore, it takes time for students to be assessed and as more time passes, more students are assessed thereby increasing the reported number of students with disabilities. 

 **Students with Disabilities Counts by School District 2021-22 School Year**
```{r}
source("W:/Project/RDA Team/Region 5 State of the Child/R/disabilties.R")
library(kableExtra)
kbl(av_table) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))
```

Source: [California Department of Education, 2016-2022](https://dq.cde.ca.gov/dataquest/)

American Indian Alaskan Native (AIAN) students had the highest percentage of students with disabilities by race/ethnicity with 21.3% of AIAN students having disabilities. Black (20.8%), Two or More Races (16.7%) and White students (15.6%) all had above Antelope Valley average rates as well. Given the extremely large number of students with disabilities, the Antelope Valley has an urgent priority need for additional resources for students with disabilities. 

```{r}
# AV Bar Chart
s <- AV 
tot = subset(s, select=c(total_rate)) %>% round(1)  # pull out total_rate
s = subset(s, select=-c(total_rate)) # pull out raced rates
oldnames = c("nh_black_rate","nh_aian_rate", "nh_asian_rate", "nh_filipino_rate", "latino_rate", "nh_pacisl_rate", "nh_white_rate", "nh_twoormor_rate")
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
s = s %>% rename_at(vars(oldnames), ~ engvar)

# create english / spanish labels
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
esvar = c("Negro", "Indígena Americano", "Asiático", "Filipino", "Latino", "Isleño del Pacifico", "Blanco", "Dos o mas") 
#esvar_long = c("NEGRO O AFROAMERICANO", "INDÍGENA AMERICANO O NATIVO DE ALASKA", "ASIÁTICO", "FILIPINO", "LATINO", "ISLEÑO DEL PACIFICO", "BLANCO", "DOS O MAS")
labels <- data.frame(engvar, esvar)
# labels


# convert df to long format
s_long <- reshape2::melt(s, id.vars=c("geoname"))
# Round 'value' field to 1 decimal, rename 'variable' field, add Spanish labels
s_long <- s_long %>% mutate(value = round(value, 1)) %>% dplyr::rename(engvar = variable)  %>% 
  left_join(labels, by = "engvar")
s_long <- s_long %>% filter(value > 0)


df <- data.frame(s_long, tot)       # add total_rate to long table
df <- na.omit(df)             # drop NA's
# df

engtot_stat <- paste("Overall Rate =", min(df$total_rate))   # total_rate line annotation
estot_stat <- paste("Promedio Total =", min(df$total_rate))   # total_rate line annotation


# Set region name for file name
region <- "Antelope Valley"


# write the name of your indicator here:
var <- "special_needs"


# Define chart height as max y value varies by indicator. Set vertical position for total line label - may need to be customized for each chart.
max_y = 1.15 * max(df$value) 
annotate_y = 1.12 * df$total_rate

# specify language: comment out based on language of chart created below
lang <- "eng"


# # ggplot method that should export as .svg ##
av_plot <- 
  #English
  ggplot(df, aes(x= reorder(engvar, -value), y=value)) +     # set up manual fill using 'test', add "-" before value to order bars when MAX is best
  annotate("text", x=6.25, y = annotate_y, label = str_wrap(engtot_stat, width = 20), hjust=-0.33, vjust = 0.35, family= font_table_text, color = red) +  
  labs(title = "**<span style='font-size:20pt;'>Children with Disabilities (%)</span>**", subtitle = region, caption = "*American Indian and Alaska Native (AIAN), Native Hawaiian and Pacific Islander (NHPI)") +
  # rest of chart    
  geom_bar(stat="identity", position = position_dodge(0.7), show.legend = FALSE) +
  geom_col(fill = lightblue, color = darkblue) +         # all bars in "#355C7D"
  geom_hline(aes(yintercept = round(total_rate, 1)), color = red, size = .5) + 
  geom_text(aes(label = round(value, digits = 1)), family = font_bar_label, hjust = -.5) +       # format data labels, adjust hjust to avoid overlap w/ total line
  # scale_y_continuous(limits = c(0, max_y), breaks = seq(0, max_y, by = 20)) +
  scale_x_discrete(labels = function(engvar) str_wrap(engvar, width = 20)) +            # wrap long labels
  xlab("") +
  ylab("") +
  coord_flip()
# av_plot

av_plot <- av_plot + theme(
  panel.background = element_rect(fill = "transparent"), # bg of the panel
  plot.background = element_rect(fill = 'transparent', color=NA), 
  panel.grid.major.y = element_line(colour = textgrey),    # add major y-axis gridlines
  panel.grid.minor = element_blank(), # bg of the plot
  axis.title.x = element_blank(),
  axis.title.y = element_blank(),
  axis.text.x = element_text(size = 12, family= font_axis_label),
  axis.text.y = element_text(size = 12, family= font_axis_label),
  axis.ticks = element_blank(),
  plot.title = element_markdown(family = font_title, face = "bold", size = 15, hjust = 0),
  plot.title.position = "plot",
  plot.subtitle = element_text(family = font_title, hjust = 0), 
  plot.margin = margin(t = 10,
                       b = 10,
                       r = 10,
                       l = 10)
)


av_plot <- av_plot + ylim(0, max_y)     # add buffer between title and chart/data labels
av_plot
```

Source: [California Department of Education, 2016-2022](https://dq.cde.ca.gov/dataquest/)


## Languages of Children and Families

According to the latest American Community Survey data calculated by Lucy Wilkerson, the Antelope Valley has a diverse set of language speakers. The East Antelope Valley and Palmdale areas have a larger shares of Spanish speakers than the County or State as a whole. There are relatively fewer speakers of Asian or Pacific Islander languages, with West Antelope Valley having the largest share of this group.

**Language Spoken at Home for Antelope Valley geographies, 2020**
```{r}
source("W:/Project/RDA Team/Region 5 State of the Child/R/language.R")

library(kableExtra)
kbl(data) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```
Source: [American Community Survey 2016-2020 5-year estimates (population age 5 and over) calculated for Antelope Valley neighborhoods by Lucy Wilkerson](https://public.tableau.com/app/profile/luz3725/viz/2020CensusData-AVBESTSTARTREGION5/GRAPI)

## English Language Learners

In the Antelope Valley 14% of students were considered English Language Learners. Latinx students has the highest rate by race / ethnicity (20%). The Wilsona followed by the Keppel School Districts had the highest amount by school district, 32.5% and 29.3% respectively. In both cases it was because of the high rates for Latinx students.

 **ELL Rates by School District 2021-22 School Year**
```{r}
source("W:/Project/RDA Team/Region 5 State of the Child/R/ell.R")
library(kableExtra)
kbl(av_table) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))


```

```{r}
# AV Bar Chart
s <- AV 
tot = subset(s, select=c(total_rate)) %>% round(1)  # pull out total_rate
s = subset(s, select=-c(total_rate)) # pull out raced rates
oldnames = c("nh_black_rate","nh_aian_rate", "nh_asian_rate", "nh_filipino_rate", "latino_rate", "nh_pacisl_rate", "nh_white_rate", "nh_twoormor_rate")
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
s = s %>% rename_at(vars(oldnames), ~ engvar)

# create english / spanish labels
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
esvar = c("Negro", "Indígena Americano", "Asiático", "Filipino", "Latino", "Isleño del Pacifico", "Blanco", "Dos o mas") 
#esvar_long = c("NEGRO O AFROAMERICANO", "INDÍGENA AMERICANO O NATIVO DE ALASKA", "ASIÁTICO", "FILIPINO", "LATINO", "ISLEÑO DEL PACIFICO", "BLANCO", "DOS O MAS")
labels <- data.frame(engvar, esvar)
# labels


# convert df to long format
s_long <- reshape2::melt(s, id.vars=c("geoname"))
# Round 'value' field to 1 decimal, rename 'variable' field, add Spanish labels
s_long <- s_long %>% mutate(value = round(value, 1)) %>% dplyr::rename(engvar = variable)  %>% 
  left_join(labels, by = "engvar")
s_long <- s_long %>% filter(value > 0)


df <- data.frame(s_long, tot)       # add total_rate to long table
df <- na.omit(df)             # drop NA's
# df

engtot_stat <- paste("Overall Rate =", min(df$total_rate))   # total_rate line annotation
estot_stat <- paste("Promedio Total =", min(df$total_rate))   # total_rate line annotation


# Set region name for file name
region <- "Antelope Valley"


# write the name of your indicator here:
var <- "English Language Learners"

# Define chart height as max y value varies by indicator. Set vertical position for total line label - may need to be customized for each chart.
max_y = 1.15 * max(df$value) 
annotate_y = 1.12 * df$total_rate

# specify language: comment out based on language of chart created below
lang <- "eng"


# # ggplot method that should export as .svg ##
av_plot <- 
  #English
  ggplot(df, aes(x= reorder(engvar, -value), y=value)) +     # set up manual fill using 'test', add "-" before value to order bars when MAX is best
  annotate("text", x=6.25, y = annotate_y, label = str_wrap(engtot_stat, width = 20), hjust=-0.33, vjust = 0.35, family= font_table_text, color = red) +  
  labs(title = "**<span style='font-size:20pt;'>English Language Learners (%)</span>**", subtitle = region, caption = "*American Indian and Alaska Native (AIAN), Native Hawaiian and Pacific Islander (NHPI)") +
  # rest of chart    
  geom_bar(stat="identity", position = position_dodge(0.7), show.legend = FALSE) +
  geom_col(fill = lightblue, color = darkblue) +         # all bars in "#355C7D"
  geom_hline(aes(yintercept = round(total_rate, 1)), color = red, size = .5) + 
  geom_text(aes(label = round(value, digits = 1)), family = font_bar_label, hjust = -.5) +       # format data labels, adjust hjust to avoid overlap w/ total line
  # scale_y_continuous(limits = c(0, max_y), breaks = seq(0, max_y, by = 20)) +
  scale_x_discrete(labels = function(engvar) str_wrap(engvar, width = 20)) +            # wrap long labels
  xlab("") +
  ylab("") +
  coord_flip()
# av_plot

av_plot <- av_plot + theme(
  panel.background = element_rect(fill = "transparent"), # bg of the panel
  plot.background = element_rect(fill = 'transparent', color=NA), 
  panel.grid.major.y = element_line(colour = textgrey),    # add major y-axis gridlines
  panel.grid.minor = element_blank(), # bg of the plot
  axis.title.x = element_blank(),
  axis.title.y = element_blank(),
  axis.text.x = element_text(size = 12, family= font_axis_label),
  axis.text.y = element_text(size = 12, family= font_axis_label),
  axis.ticks = element_blank(),
  plot.title = element_markdown(family = font_title, face = "bold", size = 15, hjust = 0),
  plot.title.position = "plot",
  plot.subtitle = element_text(family = font_title, hjust = 0), 
  plot.margin = margin(t = 10,
                       b = 10,
                       r = 10,
                       l = 10)
)


av_plot <- av_plot + ylim(0, max_y)     # add buffer between title and chart/data labels
av_plot



```

Source: [California Department of Education, 2016-2022](https://dq.cde.ca.gov/dataquest/)

# Resources (and barriers to access)
Antelope Valley stakeholders have been clear about the need for additional resources, including health and mental health services, early childhood education, and parks and recreation. According to the [Los Angeles County Health Survey](http://publichealth.lacounty.gov/ha/hasurveyintro.htm), **16.4% of Antelope Valley children report difficulty accessing medical care (highest among county Service Planning Areas or SPAs)**. Medical care can be especially important for chronic conditions that need periodic medical care such as asthma. 18.8% of Antelope Valley children have been diagnosed with asthma at some point in their lives (highest among LA SPAs), meaning access to health care is especially important for the Antelope Valley population.

## Early Childhood Education
According to estimates from the [American Institutes of Research](https://elneedsassessment.org/), **no Antelope Valley ZIP code had an unmet need for infant/toddler care rate below 93.55% of eligible children in 2020**. Preschool accessibility was hardly better, with no Antelope Valley ZIP code having an unmet need for preschool rate below 64.23%. These high rates of unmet need for early care and education mean it is difficult for parents to find care for their children and may need to reduce working hours to care for them. 40.9% of Antelope Valley parents report difficulty finding childcare (highest among county SPAs).[1](http://publichealth.lacounty.gov/ha/hasurveyintro.htm)

**Unmet need for infant/toddler and preschool-aged children, 2020**
```{r}
drv <- dbDriver("PostgreSQL")

con <- dbConnect(drv, dbname = "region5stateofthechild",
                   host = "aws-postgres-db.c5udgz7ro8hq.us-west-2.rds.amazonaws.com", port = 5432,
                   user = "postgres", password = pw)

ece_access_it_2020 <- st_read(con, query = "SELECT zipcode, neighborhood, unmet_need_children_it, pct_unmet_need_children_it FROM data.ece_access_it_2020")

ece_access_it_2020 <- ece_access_it_2020 %>% rename(
  "ZIP code" = zipcode,
  "Neighborhood" = neighborhood,
  "Unmet need for infant/toddler care" = unmet_need_children_it,
  "% of infant/toddlers with unmet need" = pct_unmet_need_children_it
)

ece_access_it_2020$Neighborhood <- gsub('[{]', '', ece_access_it_2020$Neighborhood)
ece_access_it_2020$Neighborhood <- gsub('[}]', '', ece_access_it_2020$Neighborhood)
ece_access_it_2020$Neighborhood <- gsub('["]', '', ece_access_it_2020$Neighborhood)
ece_access_it_2020$Neighborhood <- gsub('[,]', ', ', ece_access_it_2020$Neighborhood)

ece_access_prek_2020 <- st_read(con, query = "SELECT zipcode, neighborhood, unmet_need_children_prek, pct_unmet_need_children_prek FROM data.ece_access_prek_2020")

ece_access_prek_2020 <- ece_access_prek_2020 %>% rename(
  "ZIP code" = zipcode,
  "Neighborhood" = neighborhood,
  "Unmet need for preschool" = unmet_need_children_prek,
  "% of preschoolers with unmet need" = pct_unmet_need_children_prek
)

ece_access_prek_2020$Neighborhood <- gsub('[{]', '', ece_access_prek_2020$Neighborhood)
ece_access_prek_2020$Neighborhood <- gsub('[}]', '', ece_access_prek_2020$Neighborhood)
ece_access_prek_2020$Neighborhood <- gsub('["]', '', ece_access_prek_2020$Neighborhood)
ece_access_prek_2020$Neighborhood <- gsub('[,]', ', ', ece_access_prek_2020$Neighborhood)

library(kableExtra)
kbl(ece_access_it_2020) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

library(kableExtra)
kbl(ece_access_prek_2020) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```
Source: [American Institutes of Research, 2020](https://elneedsassessment.org/)

<!--
# ```{r}
# #bilingual chart
# av_bilingual <- ece_access_prek_2020
# av_bilingual <- av_bilingual %>% dplyr::rename("Zip Code - Codigo Postal" = "ZIP code",
#   "Neighborhood - Vecindario"="Neighborhood", "Unmet need for Preschool - Necesidad no satisfecha en preescolar"="Unmet need for preschool", "% of preschoolers with unmet need - % de niños en edad preescolar con necesidades insatisfechas"="% of preschoolers with unmet need")
# 
# kbl(av_bilingual) %>%
#  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))
# # View(av_bilingual)


 ``` 
 -->


## Parks
The Los Angeles County County Department of Parks and Recreation completed a Countywide Parks and Recreation Needs Assessment addition in 2022. The assessment has findings for the region in an [Antelope Valley regional profile](https://lacountyparkneeds.org/wp-content/uploads/2022/11/AppA_RegionalProfiles_AntelopeValley_11282022.pdf). Some key findings from that profile:

* The regional recreation facilities and trails in the area are poorly served by public transportation and largely inaccessible without the use of a personal vehicle.
* The highest Regional Recreation Need is found in Lake Los Angeles, Littlerock, and Sun Village due to a combination of social and environmental factors.
* Community members identified heat, distance, safety, lack of information and limited facilities as barriers to park use for residents in the study area.
* **Residents say they need more shade, cooling centers and access to water, affordable transit access to parks, additional facilities and programming, enhanced safety measures and more information about parks and amenities**.

# Economics 

## Rent Burden (Cost Burden Renter)


East Antelope Valley had the highest rates of its population being rent burdened, meaning that they were spending over 30% of their income on rent, 62.3%.

 **Rent Burden Rates by AV Neighborhood 2016-2020 (30% or more of income spent on rent)**
```{r}
source("W:/Project/RDA Team/Region 5 State of the Child/R/rent_burden_totals.R")
library(kableExtra)
kbl(av_table) %>%
 kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))


```

Source: [American Community Survey 2016-2020 5-year estimates calculated for Antelope Valley neighborhoods by Lucy Wilkerson](https://public.tableau.com/app/profile/luz3725/viz/2020CensusData-AVBESTSTARTREGION5/GRAPI)

<!--  ```{r}
# #bilingual chart
# av_bilingual <- av_table
# av_bilingual <- av_bilingual %>% dplyr::rename("Rent Burdened - Alquiler Dañado" = "Rent_Burdened",
#   "Neighborhood - Vecindario"="NEIGHBORHOOD")
# kbl(av_bilingual) %>%
#  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

``` -->


```{r}
# ## AV Bar Chart
# 
# s <- df %>% select("NEIGHBORHOOD", "Rent_Burdened") %>% as.data.frame()
# tot <- s %>% select(Rent_Burdened)%>% filter(Rent_Burdened!="59.2") %>% round(1)  # pull out total_rate
# s <-  s %>% filter(Rent_Burdened!="59.2") # pull out raced rates
# 
# # create english / spanish labels
# engvar = c("NEIGHBORHOOD", "Rent_Burdened")
# esvar = c("VECINDARIO", "ALQUILER CARGADO")
# labels <- data.frame(engvar, esvar)
# # labels
# 
# df_chart <- data.frame(s, tot) %>% dplyr::rename("total_rate" = "Rent_Burdened.1")        # add total_rate to long table s_long
# df_chart <- na.omit(df_chart)             # drop NA's
# # create labels
# label <-  c("NEIGHBORHOOD", "Rent_Burden") %>% as.data.frame()
# 
# # df_chart
# engtot_stat <- paste("Overall Rate =", min(df_chart$total_rate))   # total_rate line annotation
# estot_stat <- paste("Promedio Total =", min(df_chart$total_rate))   # total_rate line annotation
# 
# region <- "Antelope Valley"
# 
# # Define chart height as max y value varies by indicator. Set vertical position for total line label - may need to be customized for each chart.
# max_y = 1.15 * max(df$Rent_Burdened)
# annotate_y = 1.12 * (df_chart$total_rate)
# 
# av_plot <- ggplot(df_chart, aes(x=NEIGHBORHOOD, y=Rent_Burdened))+
#   annotate("text", hjust=-0.33, vjust = 0.35, label = str_wrap(engtot_stat, width = 20), family= font_table_text, color = red)+ #, x=6.25, y = annotate_y,  ,
#   geom_bar(stat = "identity", position = position_dodge(0.7), show.legend = FALSE) +
#   labs(title = "Rent Burden Rates (%)", subtitle = region) +
#   geom_col(fill = lightblue, color = darkblue) +
#   geom_hline(aes(yintercept = round(total_rate, 1)), color = red, size = .5) +
#   geom_text(aes(label = round(value, digits = 1)), family = font_bar_label, hjust = -.5) +
#   coord_flip()
# av_plot


```


## Foreclosures

## Evictions

## Cost of Living

According to the United Ways of California, **roughly half of households in and around Lancaster and Palmdale do not earn sufficient incomes to meet their basic costs of living** (i.e., they earn incomes below the real cost measure of living). Lancaster and Palmdale adjusted median household incomes are well below other parts of the County and State.

**Households below the real cost of living and median household income, 2019**
```{r}
source("W:/Project/RDA Team/Region 5 State of the Child/R/cost_of_living.R")

library(kableExtra)
kbl(rcm_data) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```
Source: [United Ways of California Real Cost Measure, 2019](https://www.unitedwaysca.org/realcost/39-real-cost)

<!-- 
```{r}
# #bilingual chart
# av_bilingual <- rcm_data
# av_bilingual$"Geography"[av_bilingual$"Geography" == 'Los Angeles County (North Central)--Lancaster City'] <- 'Los Ángeles County (North Central) Lancaster City - Condado de Los Ángeles Ciudad de Lancaster (Norte Central)'
# av_bilingual$"Geography"[av_bilingual$"Geography" == 'Los Angeles County (North Central)--Palmdale City'] <- 'Los Ángeles County (North Central) Palmdale City - Condado de Los Ángeles Ciudad de Palmdale (Norte Central)'
# av_bilingual$"Geography"[av_bilingual$"Geography" == 'Los Angeles County'] <- 'Los Ángeles County - Condado de Los Ángeles'
# av_bilingual$"Geography"[av_bilingual$"Geography" == 'State of California'] <- 'State of California - Estado de California'
# 
# av_bilingual <- av_bilingual %>% dplyr::rename("Geography - Geografía"="Geography", "Households below RCM - Hogares por debajo de la CRM (%)" = "% Households Below RCM",
# "White Households Below RCM - Hogares blancos por debajo de RCM (%)"="% White Households Below RCM",
# "Black Households below RCM - Hogares negros por debajo de RCM (%)"="% Black Households Below RCM",
# "Latino Households below RCM - Hogares latinos por debajo de RCM (%)"= "% Latino Households Below RCM",
# "Households with a child under 6 below RCM - Hogares con un niño menor de 6 años por debajo de la CRM (%)"="% Households with a child under 6 Below RCM",
#  "Median Adjusted Household Income - Hogares mediano con ingreso familiar ajustado"="Median Adjusted Household Income")
# kbl(av_bilingual) %>%
#  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))
# # View(av_bilingual)

```
-->

## Food Insecurity 

Feeding America estimates that 55,110 children are food insecure in Congressional District 25, covering Antelope Valley[1](https://map.feedingamerica.org/district/2020/overall/california/district/25). **Over 10,000 Antelope Valley children under 5  participate in WIC**. Latinx children comprise the largest share of Antelope Valley WIC participants, with nearly 1 in 5 Palmdale participants live in a Spanish-only home. Black children make up nearly 1 in 4 Lancaster WIC participants.

**WIC participants by race, Antelope Valley geographies, 2021**
```{r}
source("W:/Project/RDA Team/Region 5 State of the Child/R/food_security.R")

library(kableExtra)
kbl(wic_data) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```
Source: [L.A. County WIC Administrative Data, 2021](https://lawicdata.org/data-research/by-region/)

# Education

## Highschool Graduation

The average high school graduation rate in the Antelope Valley is 65%. In the AV, Latinx (63.6%) followed by Black (64.8%) students had the lowest graduation rates while Filipino (82.7%) and Asian (80.7%) students had the highest. The Acton-Agua Dulce Unified School District has the lowest graduation rate (34.7%). Notably in the Acton-Agua Dulce Unified School District Latinx, Black, Filipino, and students who identified as non-Hispanic Two or More Races all had under 50% graduation rates. The Gorman Joint School District had the highest rate (81.9%). 

The Antelope Valley Union High School District had a total rate of 80.3%, comparable to the LA County average. Similar to county trends, Black students had the lowest graduation rates (73.1%) followed by students who identified as Two or More Races (80.9%) and Latinx students (81.5%). Filipino (93.8%) followed by Asian (88.6%) and White (81.9%) students have the highest rates.

**Highschool Graduation Rates by School District 2021-22 School Year**
```{r}
source("W:/Project/RDA Team/Region 5 State of the Child/R/hs_grad.R")
library(kableExtra)
kbl(av_table) %>%
 kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))
```

<!-- 
```{r}
# #bilingual chart
# av_bilingual <- av_table
# av_bilingual$"Adjusted 5-Year 2020-2021"[av_bilingual$"Adjusted 5-Year 2020-2021" == 'Rate'] <- 'Rate - Tasa'
# av_bilingual$"Adjusted 5-Year 2020-2021"[av_bilingual$"Adjusted 5-Year 2020-2021" == 'Count'] <- 'Count -  Calculación'
# av_bilingual$"Asian"[av_bilingual$"Asian"=="88.0"] <- '88'
# av_bilingual$"Black"[av_bilingual$"Black"=="797.0"] <- '797'
# av_bilingual$"Filipino"[av_bilingual$"Filipino"=='67.0'] <- '67'
# av_bilingual$"Latinx"[av_bilingual$"Latinx"=='3539.0'] <- '3539'
# av_bilingual$"Two or More Races"[av_bilingual$"Two or More Races"=="234.0"] <- '234'
# av_bilingual$"White"[av_bilingual$"White"=="843.0"] <- '843'
# 
# av_bilingual <- av_bilingual %>% dplyr::rename("Adjusted 5-year–Modificación de 5 años (2020-2021)" = "Adjusted 5-Year 2020-2021",
# "Asian-Asiático"="Asian",
# "Black-Negro"="Black",
# "Latinx–Latino"= "Latinx",
# "Two or more-Dos o más"="Two or More Races",
#  "White-Blanco"="White")
# kbl(av_bilingual) %>%
#  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

``` 
-->

Source: [California Department of Education, Adjusted Five-Year Cohort Graduation Rate and Outcome Data, 2020-2021](https://www.cde.ca.gov/ds/ad/filesacgr.asp)

```{r}
# AV Bar Chart

s <- AV 
tot = subset(s, select=c(total_rate)) %>% round(1)  # pull out total_rate
s = subset(s, select=-c(total_rate)) # pull out raced rates
oldnames = c("nh_asian_rate", "nh_black_rate", "nh_filipino_rate", "latino_rate", "nh_twoormor_rate", "nh_white_rate")
engvar = c("Asian", "Black", "Filipinx", "Latinx", "Two or more", "White")
s = s %>% rename_at(vars(oldnames), ~ engvar)

# create english / spanish labels
engvar = c("Black", "AIAN", "Asian", "Filipinx", "Latinx", "NHPI", "White", "Two or more")
esvar = c("Negro", "Indígena Americano", "Asiático", "Filipino", "Latino", "Isleño del Pacifico", "Blanco", "Dos o mas") 
#esvar_long = c("NEGRO O AFROAMERICANO", "INDÍGENA AMERICANO O NATIVO DE ALASKA", "ASIÁTICO", "FILIPINO", "LATINO", "ISLEÑO DEL PACIFICO", "BLANCO", "DOS O MAS")
labels <- data.frame(engvar, esvar)
# labels


# convert df to long format
s_long <- reshape2::melt(s, id.vars=c("geoname"))
# Round 'value' field to 1 decimal, rename 'variable' field, add Spanish labels
s_long <- s_long %>% mutate(value = round(value, 1)) %>% dplyr::rename(engvar = variable)  %>% 
  left_join(labels, by = "engvar")
s_long <- s_long %>% filter(value > 0)


df <- data.frame(s_long, tot)       # add total_rate to long table
df <- na.omit(df)             # drop NA's
# df

engtot_stat <- paste("Overall Rate =", min(df$total_rate))   # total_rate line annotation
estot_stat <- paste("Promedio Total =", min(df$total_rate))   # total_rate line annotation


# Set region name for file name
region <- "Antelope Valley"


# write the name of your indicator here:
var <- "hs_graduation"


# Define chart height as max y value varies by indicator. Set vertical position for total line label - may need to be customized for each chart.
max_y = 1.15 * max(df$value)
annotate_y = 1.12 * (df$total_rate)

# specify language: comment out based on language of chart created below
lang <- "eng"




# # ggplot method that should export as .svg ##
av_plot <-
  #English
  ggplot(df, aes(x= reorder(engvar, -value), y=value)) +     # set up manual fill using 'test', add "-" before value to order bars when MAX is best
  annotate("text", x=6.25, y = annotate_y, label = str_wrap(engtot_stat, width = 20), hjust=-0.33, vjust = 0.35, family= font_table_text, color = red) +
  labs(title = "**<span style='font-size:20pt;'>High School Graduation Rates (%)</span>**", subtitle = region, caption = "*American Indian and Alaska Native (AIAN), Native Hawaiian and Pacific Islander (NHPI)") +
  # rest of chart
  geom_bar(stat="identity", position = position_dodge(0.7), show.legend = FALSE) +
  geom_col(fill = lightblue, color = darkblue) +         # all bars in "#355C7D"
  geom_hline(aes(yintercept = round(total_rate, 1)), color = red, size = .5) +
  geom_text(aes(label = round(value, digits = 1)), family = font_bar_label, hjust = -.5) +       # format data labels, adjust hjust to avoid overlap w/ total line
  # scale_y_continuous(limits = c(0, max_y), breaks = seq(0, max_y, by = 20)) +
  scale_x_discrete(labels = function(engvar) str_wrap(engvar, width = 20)) +            # wrap long labels
  xlab("") +
  ylab("") +
  coord_flip()
# av_plot

av_plot <- av_plot + theme(
  panel.background = element_rect(fill = "transparent"), # bg of the panel
  plot.background = element_rect(fill = 'transparent', color=NA),
  panel.grid.major.y = element_line(colour = textgrey),    # add major y-axis gridlines
  panel.grid.minor = element_blank(), # bg of the plot
  axis.title.x = element_blank(),
  axis.title.y = element_blank(),
  axis.text.x = element_text(size = 12, family= font_axis_label),
  axis.text.y = element_text(size = 12, family= font_axis_label),
  axis.ticks = element_blank(),
  plot.title = element_markdown(family = font_title, face = "bold", size = 15, hjust = 0),
  plot.title.position = "plot",
  plot.subtitle = element_text(family = font_title, hjust = 0),
  plot.margin = margin(t = 10,
                       b = 10,
                       r = 10,
                       l = 10)
)


av_plot <- av_plot + ylim(0, max_y)     # add buffer between title and chart/data labels
av_plot
```


Source: [California Department of Education, Adjusted Cohort Graduation Rate and Outcome Data, 2016-2022](https://www.cde.ca.gov/ds/ad/filesacgr.asp)

## Teacher & Staff Diversity 

The most recent California Department of Education data on certificated staff is from the 2018-19 school year. It shows that **the majority of AV school district students are Latinx but see relatively few Latinx teachers**. In that year White students made up 13.4% of enrolled students and White staff made up 69.4% of certificated staff. By contrast Latinx students made up 63.2% of enrolled students and Latinx staff made up 17.9% of certificated staff

**Shares of student enrollment & certificated staff in Antelope Valley schools, 2018-19**
```{r}

drv <- dbDriver("PostgreSQL")

con <- dbConnect(drv, dbname = "region5stateofthechild",
                   host = "aws-postgres-db.c5udgz7ro8hq.us-west-2.rds.amazonaws.com", port = 5432,
                   user = "postgres", password = pw)

av_staff_student_race <- st_read(con, query = "SELECT * FROM av_staff_student_race")

library(kableExtra)
kbl(av_staff_student_race) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```
Source: [California Department of Education, 2018-19](https://www.cde.ca.gov/ds/)

## Chronic Absenteeism
**More than 1 in 6 Antelope Valley students (17.5%) were chronically absent in the 2018-19 school year**, the last year we have a complete year's data from the California Department of Education. Black students were most likely to be chronically absent in Antelope Valley schools with 27.5% of eligible Black Antelope Valley students absent for 10% or more of the days they were expected to attend.

Chronic absenteeism stems for a variety of factors including student-specific, family-specific, school-specific, and community-specific factors, which vary by age. For example, schools that do not engage children and families with work schedules making it difficult to monitor their children's schooling, are two contributors to absenteeism.[1](https://www.brookings.edu/research/chronic-absenteeism-an-old-problem-in-search-of-new-answers/).

**Chronic Absenteeism in Antelope Valley Schools, 2018-19**
```{r}

drv <- dbDriver("PostgreSQL")

con <- dbConnect(drv, dbname = "region5stateofthechild",
                   host = "aws-postgres-db.c5udgz7ro8hq.us-west-2.rds.amazonaws.com", port = 5432,
                   user = "postgres", password = pw)

av_chronic_absenteeism_18_19 <- st_read(con, query = "SELECT * FROM av_chronic_absenteeism_18_19")

library(kableExtra)
kbl(av_chronic_absenteeism_18_19) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```
Source: Catalyst California calculations of [California Department of Education, 2018-19](https://www.cde.ca.gov/ds/ad/filesabd.asp) data. Antelope Valley schools are schools from the following districts: Acton-Agua Dulce Unified, Antelope Valley Union High, Eastside Union Elementary, Gorman Joint, Hughes-Elizabeth Lakes Union Elementary, Keppel Union Elementary, Lancaster Elementary, Palmdale Elementary, Westside Union Elementary, and Wilsona Elementary.

## Suspensions
The last full year of in-class learning for which the California Department of Education publishes data is 2018-19. That year **suspension rates for Black students were higher than district totals in every Antelope Valley school district**. American Indian or Alaska Native and Multiracial suspension rates were also often above totals in most area school districts.

**Suspension rates by race, Antelope Valley school districts, 2018-19**
```{r}

drv <- dbDriver("PostgreSQL")

con <- dbConnect(drv, dbname = "region5stateofthechild",
                   host = "aws-postgres-db.c5udgz7ro8hq.us-west-2.rds.amazonaws.com", port = 5432,
                   user = "postgres", password = pw)

district_suspensions_by_race_2018_19 <- st_read(con, query = "SELECT districtname as district,
nh_black_rate as black, 
latino_rate as latinx, 
nh_white_rate as white, 
nh_aian_rate as aian, 
nh_asian_rate as asian, 
nh_filipino_rate as filipino,  
nh_pacisl_rate as nhpi, 
nh_twoormor_rate as multiracial, 
total_rate as total
                                                FROM district_suspensions_by_race_2018_19
WHERE districtname IN ('Acton-Agua Dulce Unified',
    'Antelope Valley Union High',
    'Eastside Union Elementary',
    'Gorman Joint',
    'Hughes-Elizabeth Lakes Union Elementary',
    'Keppel Union Elementary',
    'Lancaster Elementary',
    'Palmdale Elementary',
    'Westside Union Elementary',
    'Wilsona Elementary') ORDER BY total_rate DESC")

library(kableExtra)
kbl(district_suspensions_by_race_2018_19) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```
Source: [California Department of Education, 2018-19](https://www.cde.ca.gov/ds/)

## 3rd Grade Math Scores

The California Department of Education suppresses data for districts under a certain count, for that reason, there is not a lot of data available for 3rd grade math scores at the district level. The Los Angeles County average was 37% while the one district with data at the AV level was 32%, slightly lower than the Los Angeles County average. In Los Angleles County, Asian 3rd grade students scored the best, followed by White and Filipino students while AIAN, Black, and Latinx students scored the worst. Compared to Los Angeles County, White 3rd grade students in the Hughes-Elizabeth School District scored worse than their Los Angeles County counterparts scored worse by almost 18 percentage points in Math.

**Los Angeles County 3rd Grade Math Scores**
```{r}
source("W:/Project/RDA Team/Region 5 State of the Child/R/math.R")

library(kableExtra)
kbl(la_table) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```
**Antelope Valley District Level 3rd Grade Math Scores**
```{r}

kbl(av_table) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```

## 3rd Grade English Scores

The California Department of Education suppresses data for districts under a certain count, for that reason, there is not a lot of data available for 3rd grade math scores at the district level. The Los Angeles County average was 37% while the one district with data at the AV level was 32%, slightly lower than the Los Angeles County average.Simiar to the Math trends, in English and Language Arts, Asian, Filipino, and White 3rd grade students had the highest ELA scores in Los Angleles County. The LA County average was 35.7%. Comparatively Hughes-Elizabeth Lake Elementary School District, the only AV school District with data, scored 16.5 percentage points higher than their Los Angeles County counterparts. That said, White students in the Hughes-Elizabeth Lake Elementary School District still scored lower than their LA County counterparts by 11.5 percentage points.

**Los Angeles County 3rd Grade English and Language Arts Scores**
```{r}
source("W:/Project/RDA Team/Region 5 State of the Child/R/ela.R")

library(kableExtra)
kbl(la_table) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```
**Antelope Valley District Level 3rd Grade English and Language Arts Scores**
```{r}

kbl(av_table) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```
# Safety and Justice 

## Police Violence
In Antelope Valley ZIP codes, law enforcement visits the most violence on Black residents per 100,000 people.
```{r}
source("W:/Project/RDA Team/Region 5 State of the Child/R/use_of_force.R")

library(kableExtra)
kbl(police_violence_data) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```
Source: California Department of Justice 2016-21 and American Community Survey 5-year population estimates. Catalyst California aggregated incidents of violence and population figures and calculated rates of violence visited on civilians per 1,000 people.

## Traffic Stops
Black and NHPI populations are significantly more likely to be stopped by the Sheriff's Police Department than the race groups. 
For example, Blacks are 2.4 times more likely to be stopped than Whites and NHPIs are 2.5 times more likely to be stopped than Whites. While there is not a data set available that can be clipped for the just the Antelope Valley region, we do see that within the police jurisdiction that covers this region, there is a racial discrepancy in stop rates. 
```{r}
library(RPostgreSQL)
con <- dbConnect(drv, dbname = "region5stateofthechild",
                   host = "aws-postgres-db.c5udgz7ro8hq.us-west-2.rds.amazonaws.com", port = 5432,
                   user = "postgres", password = pw)
df <- dbGetQuery(con, "SELECT * FROM lasd_stop_rate_by_race_2020")



df_stop_rate<-df%>%
  gather(measure_rate, value_rate, asian:twoormor_rate, factor_key = TRUE)%>%
  filter(grepl('_rate', measure_rate)) %>% #filtering for rates only 
  mutate(race_label = ifelse(measure_rate %in% 'total_rate', "Total",
                             ifelse(measure_rate %in% 'latinx_rate', "Latinx",
                                    ifelse(measure_rate %in% 'black_rate', "Black",
                                           ifelse(measure_rate %in% 'asian_rate',"Asian",
                                                  ifelse(measure_rate %in% 'aian_rate', "American Indian/Alaska Native",
                                                         ifelse(measure_rate %in% 'white_rate', "White",
                                                                ifelse(measure_rate %in% 'nhopi_rate', "Native Hawaiian/Pacific Islander",
                                                                       ifelse(measure_rate %in% 'twoormor_rate', "Two or More", "Blank")))))))))

df_stop_rate$value_rate <- as.numeric(df_stop_rate$value_rate)

#convert to long for estimates only

df_stop_est<-df%>%
  select(1:12)%>%
  gather(measure_est, value_est, asian:all_races, factor_key = TRUE)%>%
  filter(!grepl('_rate', measure_est)) %>% #filtering for rates only 
  mutate(race_label = ifelse(measure_est %in% 'all_races', "Total",
                             ifelse(measure_est %in% 'hispanic', "Latinx",
                                    ifelse(measure_est %in% 'black', "Black",
                                           ifelse(measure_est %in% 'asian',"Asian",
                                                  ifelse(measure_est %in% 'native_american', "American Indian/Alaska Native",
                                                         ifelse(measure_est %in% 'white', "White",
                                                                ifelse(measure_est %in% 'pacific_islander', "Native Hawaiian/Pacific Islander",
                                                                       ifelse(measure_est %in% 'multiracial', "Two or More", "Blank")))))))))%>%
  filter(!grepl('Blank', race_label))

#change order of rows to match rates table

df_stop_est<-df_stop_est[c(8,3,2,1,5,7,6,4),]
  


#now recombine

stop_data<-cbind(df_stop_rate, df_stop_est)%>%
  select(1:5,10:12)

stop_data <- stop_data[c(8, 7, 5)] %>% rename(Race = race_label,
                                              Stops_Estimated = value_est,
                                              Stops_Rate = value_rate)

library(kableExtra)
kbl(stop_data) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))

```
Source: [Open Justice CA DOJ Portal, 2020](https://openjustice.doj.ca.gov/data) <br>
[American Community Survey Table DP05, 2020](https://data.census.gov/table?tid=ACSDP5Y2020.DP05)

<!-- 
```{r}
# #bilingual chart
# av_bilingual <- stop_data
# av_bilingual$"Race"[av_bilingual$"Race" == 'Latinx'] <- 'LatinX- Latino'
# av_bilingual$"Race"[av_bilingual$"Race" == 'Black'] <- 'Black – Negro'
# av_bilingual$"Race"[av_bilingual$"Race" == 'Asian'] <- 'Asian – Asiático'
# av_bilingual$"Race"[av_bilingual$"Race" == 'American Indian/Alaska Native'] <- 'American Indian/Alaska Native - Indio americano/nativo de Alaska'
# av_bilingual$"Race"[av_bilingual$"Race" == 'White'] <- 'White - Blanco'
# av_bilingual$"Race"[av_bilingual$"Race" == 'Native Hawaiian/Pacific Islander'] <- 'Native Hawaiian/Pacific Islander - Nativo hawaiano/isleño del Pacíficoa'
# av_bilingual$"Race"[av_bilingual$"Race" == 'Two or More'] <- 'Two or more - Dos o más'
# 
# av_bilingual <- av_bilingual %>% dplyr::rename("Race - Raza"="Race", "Stops Estimated - el número estimado de paradas por la policía" = "Stops_Estimated",
# "Stops Rate - la tasa de paradas por la policía"="Stops_Rate")
# kbl(av_bilingual) %>%
#  kable_styling(bootstrap_options = c("striped", "bordered", "condensed"))
# # View(av_bilingual)

``` 
-->

